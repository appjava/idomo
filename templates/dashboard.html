<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoHome | Dashboard IoT</title>
    <link rel="shortcut icon" href="/static/favicon.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body>
    <!--Comentando la barra lateral original ya que no se usa en la versión final del PDF,
        pero se mantiene aquí por si se quiere reactivar o modificar.
    <div class="sidebar">
        <div class="nav-icon" title="Home"><i class="fas fa-home"></i></div>
        <div class="nav-icon" title="Search"><i class="fas fa-search"></i></div>
        <div class="nav-icon" title="Devices"><i class="fas fa-robot"></i></div>
        <div class="nav-icon" title="Settings"><i class="fas fa-cog"></i></div>
    </div>
    -->

    <div class="main-wrapper">
        <header class="top-header">
            
            <a href="https://echohome.pages.dev" target="_blank" style="text-decoration: none;" title="EchoHome Project">
                <h1>EchoHome Control Center</h1>
                <!--<i class="fas fa-external-link-alt" style="color: var(--purple-dark);"></i>-->
            </a>
            <div class="header-icons">
                <button id="darkModeToggle" title="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <!--<i class="fas fa-sync-alt" title="Refresh Data" onclick="updateDashboardData()"></i>-->
                <!--<i class="fas fa-user-circle" title="User Profile"></i>-->
            </div>
        </header>

        <main class="dashboard-content">
            <section class="welcome-panel">
                <h2>Welcome Home</h2>
                <p>The air quality is good and fresh. Enjoy your day!</p>
                <div class="weather-info">
                    <span><i class="fas fa-thermometer-half"></i> <span id="tempExt">+25</span>°C Exterior</span>
                    <span><i class="fas fa-cloud-sun"></i> Nublado difuso</span>
                </div>
            </section>

            <div class="content-grid">
                <div class="main-column">
                    <section id="system-status-section">
                        <h2 class="section-title">Estado del Sistema</h2>
                        <div id="charge_banner_container">
                            <div id="charge_banner" class="charge-banner">
                                <span id="charge_status_value">Cargando datos...</span>
                            </div>
                        </div>
                    </section>

                    <section id="sensors-section">
                        <h2 class="section-title">Sensores Ambientales e Internos</h2>
                        <div class="sensor-widgets-grid">
                            <div class="widget temperature-widget">
                                <div class="widget-icon temp"><i class="fas fa-thermometer-half"></i></div>
                                <div class="widget-label">{{ sensor_names.Temperature | default('Temperatura') }}</div>
                                <div class="widget-value" id="temp_value">-- °C</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon humidity"><i class="fas fa-tint"></i></div>
                                <div class="widget-label">{{ sensor_names.Humidity | default('Humedad') }}</div>
                                <div class="widget-value" id="humidity_value">-- %</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon voltage"><i class="fa-solid fa-car-battery"></i></div>
                                <div class="widget-label">{{ sensor_names.Voltage | default('Voltaje') }}</div>
                                <div class="widget-value" id="voltage_value">-- V</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon capacity"><i class="fas fa-battery-half"></i></div>
                                <div class="widget-label">{{ sensor_names.Capacity | default('Capacidad') }}</div>
                                <div class="widget-value" id="capacity_value">-- %</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon generate"><i id="solarMoon" class="fa-solid fa-sun"></i></div>
                                <div class="widget-label">Generando</div>
                                <div class="widget-value" id="generate_value">?W</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon power"><i class="fas fa-plug"></i></div>
                                <div class="widget-label">{{ sensor_names.Power | default('Potencia') }}</div>
                                <div class="widget-value" id="power_value">-- W</div>
                            </div>
                                
                            <div class="widget energy"> <!-- AÑADIR CLASE "energy" -->
                                <div class="widget-icon energy"><i class="fa-solid fa-bolt"></i></div>
                                <div class="widget-label">Energía Actual</div>
                                <div class="widget-value" id="energy_value">-- Wh</div>
                            </div>

                            <div class="widget">
                                <div class="widget-icon energy"><i class="fa-regular fa-sun"></i></div>
                                <div class="widget-label">Esperado</div>
                                <div class="widget-value" id="esperado_value">? Wh</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon hours"><i class="far fa-clock"></i></div>
                                <div class="widget-label">{{ sensor_names.Hours | default('Horas Uso') }}</div>
                                <div class="widget-value" id="hours_value">-- h</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon source"><i class="fas fa-solar-panel"></i></div>
                                <div class="widget-label">{{ sensor_names.Source | default('Fuente') }}</div>
                                <div class="widget-value" id="source_value">--</div>
                            </div>
                        </div>
                    </section>
                    <!-- ========= NUEVA SECCIÓN PARA EL GRÁFICO DE HOY ========= -->
                    <section id="today-consumption-section" class="device-group">
                        <h2 class="section-title">Consumo Acumulado Diario</h2>
                        <canvas id="todayConsumptionChart" style="max-height: 250px;"></canvas>
                    </section>
                    <!-- ======================================================= -->
                    
                    <section id="devices-section" class="device-group">
                        <h2 class="section-title">Control de Dispositivos</h2>
                        <h3>Luces</h3>
                        {% for i in range(1,5) %}
                        <div class="device-control">
                            <div class="device-info">
                                <div class="device-icon light"><i class="fas fa-lightbulb"></i></div>
                                <div>
                                    <span class="device-label">{{ device_names[i] | default('Luz ' + i|string) }}</span>
                                    <div class="status-container">
                                        <div id="status_ch{{i}}" class="status">Obteniendo estado...</div>
                                        <div id="OnAuto{{i}}" class="status auto-status"></div>
                                        <div id="OffAuto{{i}}" class="status auto-status"></div>
                                    </div>
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="switch_ch{{i}}" onchange="handleDeviceToggle({{i}}, this, '{{ device_names[i] | default('Luz ' + i|string) }}')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        {% endfor %}

                        <h3>Puntos de Energía</h3>
                        {% for i in range(5, 7)%}
                        <div class="device-control">
                            <div class="device-info">
                                <div class="device-icon power-outlet"><i class="fas fa-power-off"></i></div>
                                <div>
                                    <span class="device-label">{{ device_names[i] | default('Energía ' + (i-4)|string) }}</span>
                                    <div class="status-container">
                                        <div id="status_ch{{i}}" class="status">Obteniendo estado...</div>
                                        <div id="OnAuto{{i}}" class="status auto-status"></div>
                                        <div id="OffAuto{{i}}" class="status auto-status"></div>
                                    </div>
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="switch_ch{{i}}" onchange="handleDeviceToggle({{i}}, this, '{{ device_names[i] | default('Energía ' + (i-4)|string) }}')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        {% endfor %}
                    </section>

                    <section id="automation-section" class="device-group">
                        <h2 class="section-title">Automatización</h2>
                        <form id="automation-form" class="automation-form">
                            <div>
                                <label for="rule-channel">Canal:</label>
                                <select id="rule-channel" required>
                                    {% for i in range(1, 7) %}
                                    <option value="{{i}}">{{device_names[i] | default('Dispositivo ' + i|string) }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label for="rule-time-on">ON:</label>
                                <input type="time" id="rule-time-on">
                            </div>
                            <div>
                                <label for="rule-time-off">OFF:</label>
                                <input type="time" id="rule-time-off">
                            </div>
                            <div class="button-group">
                                <button type="submit">Establecer</button>
                                <button type="button" class="clear-button" onclick="clearAutomationForm()">Limpiar</button>
                            </div>
                        </form>
                        <div id="automation-list" class="automation-list">
                        </div>
                    </section>

                    <section id="consumption-chart-section">
                    <h2 class="section-title">Histórico de Consumo</h2>
                    <canvas id="electricityChart"></canvas>
                    </section>
                </div>
                <!--<aside class="right-panel">
                    <section id="consumption-chart-section-placeholder"> <h2 class="section-title"></h2>
                    </section>

                    <section id="consumption-chart-section">
                        <h2 class="section-title">Histórico de Carga</h2>
                        <canvas id="electricityChart"></canvas>
                    </section>

                    <section id="automation-section" class="device-group">
                        <h2 class="section-title">Automatización</h2>
                        <form id="automation-form" class="automation-form">
                            <div>
                                <label for="rule-channel">Canal:</label>
                                <select id="rule-channel" required>
                                    {% for i in range(1, 7) %}
                                    <option value="{{i}}">{{device_names[i] | default('Dispositivo ' + i|string) }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label for="rule-time-on">ON:</label>
                                <input type="time" id="rule-time-on">
                            </div>
                            <div>
                                <label for="rule-time-off">OFF:</label>
                                <input type="time" id="rule-time-off">
                            </div>
                            <div class="button-group">
                                <button type="submit">Establecer</button>
                                <button type="button" class="clear-button" onclick="clearAutomationForm()">Limpiar</button>
                            </div>
                        </form>
                        <div id="automation-list" class="automation-list">
                        </div>
                    </section>
                </aside>-->
            </div>
        </main>

        <footer class="footer">
            <p>Controlando ESP8266 en: <span>{{ esp_ip | default('N/A') }}</span> y <span>{{ esp2_ip | default('N/A') }}</span>.</p>
            <p>&copy; 2024–2025 Smart EchoHome. Todos los derechos reservados.</p>
        </footer>
    </div>
    <script src="/static/script.js"></script>
</body>
</html>
